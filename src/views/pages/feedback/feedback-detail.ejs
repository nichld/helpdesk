<div class="flex flex-col gap-6">
  <div class="flex justify-between items-center">
    <h1 class="text-3xl font-bold text-gray-900">
      Feedback Details
    </h1>
    <% if (isCustomer) { %>
      <a href="/feedback" class="text-blue-600 hover:text-blue-800 text-sm flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        Back to my feedback
      </a>
    <% } else if (isEmployee) { %>
      <a href="/admin/feedback" class="text-blue-600 hover:text-blue-800 text-sm flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        Back to all feedback
      </a>
    <% } %>
  </div>

  <div class="bg-white border border-gray-200 rounded-lg p-6">
    <!-- Rating and satisfaction summary -->
    <div class="flex flex-wrap md:flex-nowrap gap-6 mb-8">
      <div class="w-full md:w-1/2">
        <h2 class="text-xl font-medium text-gray-900 mb-4">Feedback Summary</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-y-6 gap-x-8">
          <!-- Rating -->
          <div>
            <p class="text-sm text-gray-500 mb-1">Overall Rating</p>
            <div class="flex text-yellow-500 text-xl">
              <% for(let i = 1; i <= 5; i++) { %>
                <span><%= i <= feedback.rating ? '★' : '☆' %></span>
              <% } %>
            </div>
          </div>
          
          <!-- Satisfaction Level -->
          <div>
            <p class="text-sm text-gray-500 mb-1">Satisfaction</p>
            <p class="font-medium flex items-center">
              <% const satisfactionEmoji = {
                'very-satisfied': '😃',
                'satisfied': '🙂',
                'neutral': '😐',
                'dissatisfied': '😕',
                'very-dissatisfied': '😡'
              }; %>
              <span class="text-xl mr-2"><%= satisfactionEmoji[feedback.satisfactionLevel] %></span>
              <%= feedback.satisfactionLevel.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ') %>
            </p>
          </div>
          
          <!-- Time to Resolution -->
          <div>
            <p class="text-sm text-gray-500 mb-1">Time to Resolution</p>
            <p class="font-medium flex items-center">
              <% const resolutionEmoji = {
                'too-long': '⏱️',
                'appropriate': '⏲️',
                'quick': '⚡'
              }; %>
              <span class="text-xl mr-2"><%= resolutionEmoji[feedback.timeToResolution] %></span>
              <%= feedback.timeToResolution.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ') %>
            </p>
          </div>
          
          <!-- Submitted Date -->
          <div>
            <p class="text-sm text-gray-500 mb-1">Submitted</p>
            <p class="font-medium"><%= new Date(feedback.submittedAt).toLocaleString() %></p>
          </div>
        </div>
        
        <!-- Comments -->
        <% if (feedback.comments && feedback.comments.trim()) { %>
          <div class="mt-6">
            <h3 class="text-sm text-gray-500 mb-2">Your Comments</h3>
            <div class="bg-gray-50 p-4 rounded-md text-gray-700">
              <%= feedback.comments %>
            </div>
          </div>
        <% } %>
      </div>
      
      <div class="w-full md:w-1/2 border-t md:border-t-0 md:border-l border-gray-200 pt-6 md:pt-0 md:pl-6">
        <h2 class="text-xl font-medium text-gray-900 mb-4">Ticket Information</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-y-4 gap-x-8">
          <!-- Ticket Title -->
          <div class="col-span-full">
            <p class="text-sm text-gray-500 mb-1">Ticket Title</p>
            <p class="font-medium"><%= feedback.ticketSnapshot.title %></p>
          </div>
          
          <!-- Ticket Description -->
          <div class="col-span-full">
            <p class="text-sm text-gray-500 mb-1">Description</p>
            <p class="font-medium text-gray-700 whitespace-pre-wrap">
              <% if (feedback.ticketSnapshot.description && feedback.ticketSnapshot.description.trim()) { %>
                <%= feedback.ticketSnapshot.description %>
              <% } else { %>
                <span class="text-gray-400 italic">No description provided</span>
              <% } %>
            </p>
          </div>
          
          <!-- Category -->
          <div>
            <p class="text-sm text-gray-500 mb-1">Category</p>
            <p class="font-medium"><%= feedback.ticketSnapshot.category %></p>
          </div>
          
          <!-- Status when feedback was submitted -->
          <div>
            <p class="text-sm text-gray-500 mb-1">Status</p>
            <p class="font-medium"><%= feedback.ticketSnapshot.status.charAt(0).toUpperCase() + feedback.ticketSnapshot.status.slice(1) %></p>
          </div>
          
          <!-- Created date -->
          <div>
            <p class="text-sm text-gray-500 mb-1">Ticket Created</p>
            <p class="font-medium"><%= new Date(feedback.ticketSnapshot.createdAt).toLocaleDateString() %></p>
          </div>
          
          <!-- Closed date -->
          <div>
            <p class="text-sm text-gray-500 mb-1">Ticket Closed</p>
            <p class="font-medium"><%= new Date(feedback.ticketSnapshot.closedAt).toLocaleDateString() %></p>
          </div>
          
          <!-- Message count -->
          <div>
            <p class="text-sm text-gray-500 mb-1">Total Messages</p>
            <p class="font-medium"><%= feedback.messageCount %></p>
          </div>
          
          <!-- Assigned to -->
          <div>
            <p class="text-sm text-gray-500 mb-1">Assigned To</p>
            <p class="font-medium">
              <% if (feedback.ticketSnapshot.assignedTo) { %>
                <%= feedback.ticketSnapshot.assignedTo.firstName %> <%= feedback.ticketSnapshot.assignedTo.lastName %>
              <% } else { %>
                Unassigned
              <% } %>
            </p>
          </div>
        </div>
        
        <% if (isAdmin) { %>
          <!-- Admin Actions Section -->
          <div class="mt-8 pt-4 border-t border-gray-200">
            <h3 class="text-sm font-medium text-gray-700 mb-4">Admin Actions</h3>
            
            <form action="/admin/feedback/delete" method="POST">
              <input type="hidden" name="feedbackId" value="<%= feedback._id %>">
              <button 
                type="submit" 
                class="inline-flex items-center px-4 py-2 border border-red-300 rounded-md text-sm font-medium bg-red-50 text-red-700 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors"
                onclick="return confirm('Are you sure you want to delete this feedback? This action cannot be undone.')"
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
                Delete Feedback
              </button>
            </form>
          </div>
        <% } %>
      </div>
    </div>
  </div>
  
  <!-- Message History Container -->
  <div class="bg-white border border-gray-200 rounded-lg p-6 mt-6">
    <h2 class="text-xl font-medium text-gray-900 mb-4">
      Ticket Message History
      <span class="text-sm font-normal text-gray-500 ml-2">(<%= feedback.messageHistory ? feedback.messageHistory.length : 0 %> messages)</span>
    </h2>
    
    <% if (feedback.messageHistory && feedback.messageHistory.length > 0) { %>
      <div class="space-y-4 max-h-[600px] overflow-y-auto p-2">
        <% feedback.messageHistory.forEach((message, index) => { %>
          <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
            <div class="flex items-center justify-between mb-2">
              <div class="flex items-center">
                <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-700 font-medium mr-2">
                  <%= message.senderName.charAt(0).toUpperCase() %>
                </div>
                <div>
                  <div class="font-medium"><%= message.senderName %></div>
                  <div class="text-xs text-gray-500">
                    <%= message.senderRole.charAt(0).toUpperCase() + message.senderRole.slice(1) %>
                    • <%= new Date(message.sentAt).toLocaleString() %>
                  </div>
                </div>
              </div>
              <div class="text-xs text-gray-500">
                Message <%= index + 1 %>
              </div>
            </div>
            
            <% if (message.contentType === 'text') { %>
              <div class="text-gray-700 whitespace-pre-wrap"><%= message.content %></div>
            <% } else if (message.contentType === 'image' && message.fileUrl) { %>
              <div class="mt-2">
                <img src="<%= message.fileUrl %>" alt="Image attachment" class="max-w-md max-h-64 rounded-md">
                <p class="text-sm text-gray-500 mt-1">Image attachment</p>
              </div>
            <% } %>
          </div>
        <% }); %>
      </div>
    <% } else { %>
      <div class="p-8 text-center text-gray-500 border border-dashed border-gray-300 rounded-md">
        No message history available for this ticket.
      </div>
    <% } %>
  </div>
</div>
