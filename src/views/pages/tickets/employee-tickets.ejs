<div class="bg-white rounded-lg shadow p-6">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-gray-900">All Tickets</h1>
    <a href="/admin/dashboard" class="text-blue-600 hover:text-blue-800 text-sm">
      Back to Dashboard
    </a>
  </div>

  <% if (typeof error !== 'undefined' && error) { %>
    <div class="bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-md text-sm mb-6">
      <%= error %>
    </div>
  <% } %>

  <!-- Filter options -->
  <div class="mb-6 space-y-4">
    <form action="/admin/tickets" method="GET" class="flex flex-col md:flex-row gap-4">
      <div class="flex-1">
        <label for="status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
        <select id="status" name="status" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
          <option value="" <%= filters.status === 'all' ? 'selected' : '' %>>All Statuses</option>
          <option value="open" <%= filters.status === 'open' ? 'selected' : '' %>>Open</option>
          <option value="in-progress" <%= filters.status === 'in-progress' ? 'selected' : '' %>>In Progress</option>
          <option value="solved" <%= filters.status === 'solved' ? 'selected' : '' %>>Solved</option>
          <option value="closed" <%= filters.status === 'closed' ? 'selected' : '' %>>Closed</option>
        </select>
      </div>
      
      <div class="flex-1">
        <label for="priority" class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
        <select id="priority" name="priority" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
          <option value="" <%= filters.priority === 'all' ? 'selected' : '' %>>All Priorities</option>
          <option value="low" <%= filters.priority === 'low' ? 'selected' : '' %>>Low</option>
          <option value="medium" <%= filters.priority === 'medium' ? 'selected' : '' %>>Medium</option>
          <option value="high" <%= filters.priority === 'high' ? 'selected' : '' %>>High</option>
          <option value="critical" <%= filters.priority === 'critical' ? 'selected' : '' %>>Critical</option>
        </select>
      </div>
      
      <div class="flex-1">
        <label for="category" class="block text-sm font-medium text-gray-700 mb-1">Category</label>
        <select id="category" name="category" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
          <option value="" <%= filters.category === 'all' ? 'selected' : '' %>>All Categories</option>
          <option value="Technical Issue" <%= filters.category === 'Technical Issue' ? 'selected' : '' %>>Technical Issue</option>
          <option value="Billing" <%= filters.category === 'Billing' ? 'selected' : '' %>>Billing</option>
          <option value="Account" <%= filters.category === 'Account' ? 'selected' : '' %>>Account</option>
          <option value="Feature Request" <%= filters.category === 'Feature Request' ? 'selected' : '' %>>Feature Request</option>
          <option value="Other" <%= filters.category === 'Other' ? 'selected' : '' %>>Other</option>
        </select>
      </div>
      
      <div class="self-end">
        <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md">
          Filter
        </button>
      </div>
    </form>
    
    <div class="text-right">
      <a href="/admin/tickets/assigned" class="inline-flex items-center text-blue-600 hover:text-blue-800">
        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
        </svg>
        View My Assigned Tickets
      </a>
    </div>
  </div>

  <!-- Tickets table -->
  <div class="overflow-x-auto">
    <table class="min-w-full bg-white border border-gray-200 divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Title</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Priority</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Assigned To</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Activity</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        <% if (tickets && tickets.length > 0) { %>
          <% tickets.forEach(ticket => { %>
            <tr class="hover:bg-gray-50 cursor-pointer" onclick="window.location.href='/admin/tickets/<%= ticket._id %>'">
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"><%= ticket.title %></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                <%= ticket.customer.firstName %> <%= ticket.customer.lastName %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><%= ticket.category %></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <% if (ticket.status === 'open') { %>
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                    Open
                  </span>
                <% } else if (ticket.status === 'in-progress') { %>
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                    In Progress
                  </span>
                <% } else if (ticket.status === 'solved') { %>
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                    Solved
                  </span>
                <% } else if (ticket.status === 'closed') { %>
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-800 text-white">
                    Closed
                  </span>
                <% } %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <% if (!ticket.priority) { %>
                  <span class="text-gray-500">N/A</span>
                <% } else if (ticket.priority === 'low') { %>
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                    Low
                  </span>
                <% } else if (ticket.priority === 'medium') { %>
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                    Medium
                  </span>
                <% } else if (ticket.priority === 'high') { %>
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-orange-100 text-orange-800">
                    High
                  </span>
                <% } else if (ticket.priority === 'critical') { %>
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                    Critical
                  </span>
                <% } %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                <% if (ticket.assignedTo) { %>
                  <%= ticket.assignedTo.firstName %> <%= ticket.assignedTo.lastName %>
                <% } else { %>
                  <span class="text-gray-400">Unassigned</span>
                <% } %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                <%= new Date(ticket.lastActivity).toLocaleString() %>
              </td>
            </tr>
          <% }); %>
        <% } else { %>
          <tr>
            <td colspan="7" class="px-6 py-4 text-center text-sm text-gray-500">
              No tickets found that match your filters.
            </td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>
</div>
